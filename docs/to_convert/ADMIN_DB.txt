create or replace database ADMIN_DB;

create or replace schema MASKING;

create or replace masking policy DATE_MASKING_POLICY as (VALUE DATE) 
returns DATE ->
case
    -- Full access:
    -- Example output: 2024-06-12
    when SYSTEM$GET_TAG('ADMIN_DB.TAGS.MASKDATA_ROLE_TAG',current_role(), 'role') = 'NONE' or
        SYSTEM$GET_TAG('ADMIN_DB.TAGS.MASKDATA_ROLE_TAG',current_role(), 'role') = NULL
      then value 
      
    -- Any level of masking
    -- Example output: 2024-01-01
    else DATE_TRUNC( years, value )
  end
;
create or replace masking policy TEXT_MASKING_POLICY as (VALUE VARCHAR) 
returns VARCHAR ->
case
    -- Full access:
    -- Example output: my_name
    when SYSTEM$GET_TAG('ADMIN_DB.TAGS.MASKDATA_ROLE_TAG',current_role(), 'role') = 'NONE' or
        SYSTEM$GET_TAG('ADMIN_DB.TAGS.MASKDATA_ROLE_TAG',current_role(), 'role') IS NULL
      then value
    
    -- Partial masking:
    -- Example output: xxxxxxme
    when SYSTEM$GET_TAG('ADMIN_DB.TAGS.MASKDATA_ROLE_TAG',current_role(), 'role') = 'PARTIAL'
      then 
       case when SYSTEM$GET_TAG_ON_CURRENT_COLUMN('ADMIN_DB.TAGS.MASKING_TAG') = 'EMAIL'
                then regexp_replace(value,'.+\@','*********@')
            else
                CONCAT('*******',
                    SUBSTRING(value, -2)
                    )
                end
      
    -- Pseudonymised masking:
    -- Example output: 1dbd59f661d68b90724f21084396b865497173e4d2714f4d91cf05fa5fc5e18d
   -- when SYSTEM$GET_TAG('ADMIN_DB.TAGS.MASKDATA_ROLE_TAG',current_role(), 'role') = 'PARTIAL'
   --   then sha2(value)
      
    -- Full masking
    -- Example output: *********
    else '*********'
  end
;
create or replace schema PUBLIC;

create or replace schema ROLES;

CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_DEPLOYMENT_PROD"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN
    -- Grant basic access to the database
    EXECUTE IMMEDIATE ''GRANT USAGE ON DATABASE PROD_ANCHOR TO ROLE PROD_ANCHOR_DEPLOYMENT'';

    -- Grant access to schemas (existing only)
    EXECUTE IMMEDIATE ''GRANT USAGE ON ALL SCHEMAS IN DATABASE PROD_ANCHOR TO ROLE PROD_ANCHOR_DEPLOYMENT'';
    
    -- Allow creation of schemas
    EXECUTE IMMEDIATE ''GRANT CREATE SCHEMA ON DATABASE PROD_ANCHOR TO ROLE PROD_ANCHOR_DEPLOYMENT'';

    -- Grant object creation permissions in schemas (existing only)
    EXECUTE IMMEDIATE ''
        GRANT CREATE TABLE, CREATE VIEW, CREATE MATERIALIZED VIEW, CREATE DYNAMIC TABLE, 
              CREATE STAGE, CREATE FILE FORMAT, 
              CREATE PROCEDURE, CREATE FUNCTION, CREATE PIPE 
        ON ALL SCHEMAS IN DATABASE PROD_ANCHOR 
        TO ROLE PROD_ANCHOR_DEPLOYMENT'';
        
    EXECUTE IMMEDIATE ''GRANT MODIFY ON ALL SCHEMAS IN DATABASE PROD_ANCHOR TO ROLE PROD_ANCHOR_DEPLOYMENT'';
    
    --Grant WAREHOUSE 
    EXECUTE IMMEDIATE ''GRANT USAGE ON WAREHOUSE DEV_BI_WH_XS TO ROLE PROD_ANCHOR_DEPLOYMENT'';

    -- Grant modification permissions (DML: INSERT, UPDATE, DELETE, TRUNCATE) on tables
    EXECUTE IMMEDIATE ''
        GRANT SELECT, INSERT, UPDATE, DELETE, TRUNCATE 
        ON ALL TABLES IN DATABASE PROD_ANCHOR 
        TO ROLE PROD_ANCHOR_DEPLOYMENT'';

    -- Grant SELECT permissions for all views
    EXECUTE IMMEDIATE ''
        GRANT SELECT ON ALL VIEWS IN DATABASE PROD_ANCHOR 
        TO ROLE PROD_ANCHOR_DEPLOYMENT'';

    -- Grant SELECT permissions for all materialized views
    EXECUTE IMMEDIATE ''
        GRANT SELECT ON ALL MATERIALIZED VIEWS IN DATABASE PROD_ANCHOR 
        TO ROLE PROD_ANCHOR_DEPLOYMENT'';

    -- Grant SELECT & MONITOR permissions for dynamic tables
    EXECUTE IMMEDIATE ''
        GRANT SELECT, MONITOR 
        ON ALL DYNAMIC TABLES IN DATABASE PROD_ANCHOR 
        TO ROLE PROD_ANCHOR_DEPLOYMENT'';

    -- Grant SELECT on all functions and procedures
    EXECUTE IMMEDIATE ''
        GRANT USAGE ON ALL FUNCTIONS IN DATABASE PROD_ANCHOR 
        TO ROLE PROD_ANCHOR_DEPLOYMENT'';
        
    EXECUTE IMMEDIATE ''
        GRANT USAGE ON ALL PROCEDURES IN DATABASE PROD_ANCHOR 
        TO ROLE PROD_ANCHOR_DEPLOYMENT'';

    EXECUTE IMMEDIATE ''GRANT USAGE ON INTEGRATION FACTSET_EXTERNAL_INTEGRATION TO ROLE PROD_ANCHOR_DEPLOYMENT'';
    EXECUTE IMMEDIATE ''GRANT USAGE ON INTEGRATION SPOTIFY_APIS_ACCESS_INTEGRATION TO ROLE PROD_ANCHOR_DEPLOYMENT'';
    EXECUTE IMMEDIATE ''GRANT IMPORTED PRIVILEGES ON DATABASE FACSTSET_IRNDB TO ROLE PROD_ANCHOR_DEPLOYMENT'';
    
    RETURN ''All grants executed successfully'';
END;
';
CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_DEPLOYMENT_TEST"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN
    -- Grant basic access to the database
    EXECUTE IMMEDIATE ''GRANT USAGE ON DATABASE TEST_ANCHOR TO ROLE TEST_ANCHOR_DEPLOYMENT'';

    -- Grant access to schemas (existing only)
    EXECUTE IMMEDIATE ''GRANT USAGE ON ALL SCHEMAS IN DATABASE TEST_ANCHOR TO ROLE TEST_ANCHOR_DEPLOYMENT'';
    
    -- Allow creation of schemas
    EXECUTE IMMEDIATE ''GRANT CREATE SCHEMA ON DATABASE TEST_ANCHOR TO ROLE TEST_ANCHOR_DEPLOYMENT'';

    -- Grant object creation permissions in schemas (existing only)
    EXECUTE IMMEDIATE ''
        GRANT CREATE TABLE, CREATE VIEW, CREATE MATERIALIZED VIEW, CREATE DYNAMIC TABLE, 
              CREATE STAGE, CREATE FILE FORMAT, 
              CREATE PROCEDURE, CREATE FUNCTION, CREATE PIPE 
        ON ALL SCHEMAS IN DATABASE TEST_ANCHOR 
        TO ROLE TEST_ANCHOR_DEPLOYMENT'';
        
    EXECUTE IMMEDIATE ''GRANT MODIFY ON ALL SCHEMAS IN DATABASE TEST_ANCHOR TO ROLE TEST_ANCHOR_DEPLOYMENT'';
    
    --Grant WAREHOUSE 
    EXECUTE IMMEDIATE ''GRANT USAGE ON WAREHOUSE DEV_BI_WH_XS TO ROLE TEST_ANCHOR_DEPLOYMENT'';

    -- Grant modification permissions (DML: INSERT, UPDATE, DELETE, TRUNCATE) on tables
    EXECUTE IMMEDIATE ''
        GRANT SELECT, INSERT, UPDATE, DELETE, TRUNCATE 
        ON ALL TABLES IN DATABASE TEST_ANCHOR 
        TO ROLE TEST_ANCHOR_DEPLOYMENT'';

    -- Grant SELECT permissions for all views
    EXECUTE IMMEDIATE ''
        GRANT SELECT ON ALL VIEWS IN DATABASE TEST_ANCHOR 
        TO ROLE TEST_ANCHOR_DEPLOYMENT'';

    -- Grant SELECT permissions for all materialized views
    EXECUTE IMMEDIATE ''
        GRANT SELECT ON ALL MATERIALIZED VIEWS IN DATABASE TEST_ANCHOR 
        TO ROLE TEST_ANCHOR_DEPLOYMENT'';

    -- Grant SELECT & MONITOR permissions for dynamic tables
    EXECUTE IMMEDIATE ''
        GRANT SELECT, MONITOR 
        ON ALL DYNAMIC TABLES IN DATABASE TEST_ANCHOR 
        TO ROLE TEST_ANCHOR_DEPLOYMENT'';

    -- Grant SELECT on all functions and procedures
    EXECUTE IMMEDIATE ''
        GRANT USAGE ON ALL FUNCTIONS IN DATABASE TEST_ANCHOR 
        TO ROLE TEST_ANCHOR_DEPLOYMENT'';
        
    EXECUTE IMMEDIATE ''
        GRANT USAGE ON ALL PROCEDURES IN DATABASE TEST_ANCHOR 
        TO ROLE TEST_ANCHOR_DEPLOYMENT'';

    EXECUTE IMMEDIATE ''GRANT USAGE ON INTEGRATION FACTSET_EXTERNAL_INTEGRATION TO ROLE TEST_ANCHOR_DEPLOYMENT'';
    EXECUTE IMMEDIATE ''GRANT USAGE ON INTEGRATION SPOTIFY_APIS_ACCESS_INTEGRATION TO ROLE TEST_ANCHOR_DEPLOYMENT'';
    EXECUTE IMMEDIATE ''GRANT IMPORTED PRIVILEGES ON DATABASE FACSTSET_IRNDB TO ROLE TEST_ANCHOR_DEPLOYMENT'';
    
    RETURN ''All grants executed successfully'';
END;
';
CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_DEPLOYMENT_UAT"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN
    -- Grant basic access to the database
    EXECUTE IMMEDIATE ''GRANT USAGE ON DATABASE UAT_ANCHOR TO ROLE UAT_ANCHOR_DEPLOYMENT'';

    -- Grant access to schemas (existing only)
    EXECUTE IMMEDIATE ''GRANT USAGE ON ALL SCHEMAS IN DATABASE UAT_ANCHOR TO ROLE UAT_ANCHOR_DEPLOYMENT'';
    
    -- Allow creation of schemas
    EXECUTE IMMEDIATE ''GRANT CREATE SCHEMA ON DATABASE UAT_ANCHOR TO ROLE UAT_ANCHOR_DEPLOYMENT'';

    -- Grant object creation permissions in schemas (existing only)
    EXECUTE IMMEDIATE ''
        GRANT CREATE TABLE, CREATE VIEW, CREATE MATERIALIZED VIEW, CREATE DYNAMIC TABLE, 
              CREATE STAGE, CREATE FILE FORMAT, 
              CREATE PROCEDURE, CREATE FUNCTION, CREATE PIPE 
        ON ALL SCHEMAS IN DATABASE UAT_ANCHOR 
        TO ROLE UAT_ANCHOR_DEPLOYMENT'';
        
    EXECUTE IMMEDIATE ''GRANT MODIFY ON ALL SCHEMAS IN DATABASE UAT_ANCHOR TO ROLE UAT_ANCHOR_DEPLOYMENT'';
    
    --Grant WAREHOUSE 
    EXECUTE IMMEDIATE ''GRANT USAGE ON WAREHOUSE DEV_BI_WH_XS TO ROLE UAT_ANCHOR_DEPLOYMENT'';

    -- Grant modification permissions (DML: INSERT, UPDATE, DELETE, TRUNCATE) on tables
    EXECUTE IMMEDIATE ''
        GRANT SELECT, INSERT, UPDATE, DELETE, TRUNCATE 
        ON ALL TABLES IN DATABASE UAT_ANCHOR 
        TO ROLE UAT_ANCHOR_DEPLOYMENT'';

    -- Grant SELECT permissions for all views
    EXECUTE IMMEDIATE ''
        GRANT SELECT ON ALL VIEWS IN DATABASE UAT_ANCHOR 
        TO ROLE UAT_ANCHOR_DEPLOYMENT'';

    -- Grant SELECT permissions for all materialized views
    EXECUTE IMMEDIATE ''
        GRANT SELECT ON ALL MATERIALIZED VIEWS IN DATABASE UAT_ANCHOR 
        TO ROLE UAT_ANCHOR_DEPLOYMENT'';

    -- Grant SELECT & MONITOR permissions for dynamic tables
    EXECUTE IMMEDIATE ''
        GRANT SELECT, MONITOR 
        ON ALL DYNAMIC TABLES IN DATABASE UAT_ANCHOR 
        TO ROLE UAT_ANCHOR_DEPLOYMENT'';

    -- Grant SELECT on all functions and procedures
    EXECUTE IMMEDIATE ''
        GRANT USAGE ON ALL FUNCTIONS IN DATABASE UAT_ANCHOR 
        TO ROLE UAT_ANCHOR_DEPLOYMENT'';
        
    EXECUTE IMMEDIATE ''
        GRANT USAGE ON ALL PROCEDURES IN DATABASE UAT_ANCHOR 
        TO ROLE UAT_ANCHOR_DEPLOYMENT'';

    EXECUTE IMMEDIATE ''GRANT USAGE ON INTEGRATION FACTSET_EXTERNAL_INTEGRATION TO ROLE UAT_ANCHOR_DEPLOYMENT'';
    EXECUTE IMMEDIATE ''GRANT USAGE ON INTEGRATION SPOTIFY_APIS_ACCESS_INTEGRATION TO ROLE UAT_ANCHOR_DEPLOYMENT'';
    EXECUTE IMMEDIATE ''GRANT IMPORTED PRIVILEGES ON DATABASE FACSTSET_IRNDB TO ROLE UAT_ANCHOR_DEPLOYMENT'';
    
    RETURN ''All grants executed successfully'';
END;
';
CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_MASKINGADMIN"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN
    -- Grant basic access to the database
    EXECUTE IMMEDIATE ''GRANT CREATE MASKING POLICY ON SCHEMA ADMIN_DB.MASKING TO ROLE MASKING_ADMIN'';

    -- Grant access to schemas (existing only)
    EXECUTE IMMEDIATE ''GRANT APPLY MASKING POLICY ON ACCOUNT TO ROLE MASKING_ADMIN'';
    
    RETURN ''All grants executed successfully'';
END;
';
CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_ORGLISTINGADMIN"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN
    -- Grant basic access to the database
    EXECUTE IMMEDIATE ''GRANT CREATE SHARE ON ACCOUNT TO ROLE ORGLISTING_ADMIN'';
    
    RETURN ''All grants executed successfully'';
END;
';
CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_POC_DB_MANAGER"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN
    -- Grant basic access to the database
    EXECUTE IMMEDIATE ''GRANT USAGE ON DATABASE ADMIN_DB TO ROLE POC_DB_MANAGER'';

    -- Grant access to schemas (existing only)
    EXECUTE IMMEDIATE ''GRANT USAGE ON ALL SCHEMAS IN DATABASE ADMIN_DB TO ROLE POC_DB_MANAGER'';

    --Grant WAREHOUSE 
    EXECUTE IMMEDIATE ''GRANT USAGE ON WAREHOUSE DEV_BI_WH_XS TO ROLE POC_DB_MANAGER'';

    EXECUTE IMMEDIATE ''GRANT ROLE TAG_ADMIN TO ROLE POC_DB_MANAGER'';

    EXECUTE IMMEDIATE ''GRANT ROLE MASKING_ADMIN TO ROLE POC_DB_MANAGER'';
    
    RETURN ''All grants executed successfully'';
END;
';
CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_PRD_DATAACCESSPOC_DB_ALL"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN
    -- Grant basic access to the database
    EXECUTE IMMEDIATE ''GRANT USAGE ON DATABASE PRD_DATAACCESSPOC_DB 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_ALL'';

    -- Grant access to schemas (existing only)
    EXECUTE IMMEDIATE ''GRANT USAGE ON SCHEMA PRD_DATAACCESSPOC_DB.DATAMASKING 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_ALL'';

    -- Grant object creation permissions in schemas (existing only)
    EXECUTE IMMEDIATE ''
        GRANT CREATE TABLE, CREATE VIEW, CREATE MATERIALIZED VIEW, CREATE DYNAMIC TABLE, 
              CREATE STAGE, CREATE FILE FORMAT, 
              CREATE PROCEDURE, CREATE FUNCTION, CREATE PIPE 
        ON SCHEMA PRD_DATAACCESSPOC_DB.DATAMASKING 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_ALL'';

    -- Grant modification permissions (DML: INSERT, UPDATE, DELETE, TRUNCATE) on tables
    EXECUTE IMMEDIATE ''
        GRANT SELECT, INSERT, UPDATE, DELETE, TRUNCATE 
        ON ALL TABLES IN SCHEMA PRD_DATAACCESSPOC_DB.DATAMASKING 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_ALL'';

    
    RETURN ''All grants executed successfully'';
END;
';
CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_PRD_DATAACCESSPOC_DB_EXECUTE"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN
    -- Grant basic access to the database
    EXECUTE IMMEDIATE ''GRANT USAGE ON DATABASE PRD_DATAACCESSPOC_DB 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_EXECUTE'';

    -- Grant access to schemas (existing only)
    EXECUTE IMMEDIATE ''GRANT USAGE ON SCHEMA PRD_DATAACCESSPOC_DB.DATAMASKING 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_EXECUTE'';

    -- Grant object creation permissions in schemas (existing only)
    EXECUTE IMMEDIATE ''
        GRANT CREATE TABLE, CREATE VIEW, CREATE MATERIALIZED VIEW, CREATE DYNAMIC TABLE, 
              CREATE STAGE, CREATE FILE FORMAT, 
              CREATE PROCEDURE, CREATE FUNCTION, CREATE PIPE 
        ON SCHEMA PRD_DATAACCESSPOC_DB.DATAMASKING 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_EXECUTE'';

    -- Grant modification permissions (DML: INSERT, UPDATE, DELETE, TRUNCATE) on tables
    EXECUTE IMMEDIATE ''
        GRANT SELECT, INSERT, UPDATE, DELETE, TRUNCATE 
        ON ALL TABLES IN SCHEMA PRD_DATAACCESSPOC_DB.DATAMASKING 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_EXECUTE'';

    
    RETURN ''All grants executed successfully'';
END;
';
CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_PRD_DATAACCESSPOC_DB_READ"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN
    -- Grant basic access to the database
    EXECUTE IMMEDIATE ''GRANT USAGE ON DATABASE PRD_DATAACCESSPOC_DB 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_READ'';

    -- Grant access to schemas (existing only)
    EXECUTE IMMEDIATE ''GRANT USAGE ON SCHEMA PRD_DATAACCESSPOC_DB.DATAMASKING 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_READ'';

    -- Grant object creation permissions in schemas (existing only)
    EXECUTE IMMEDIATE ''
        GRANT CREATE TABLE, CREATE VIEW, CREATE MATERIALIZED VIEW, CREATE DYNAMIC TABLE, 
              CREATE STAGE, CREATE FILE FORMAT, 
              CREATE PROCEDURE, CREATE FUNCTION, CREATE PIPE 
        ON SCHEMA PRD_DATAACCESSPOC_DB.DATAMASKING 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_READ'';

    -- Grant modification permissions (DML: INSERT, UPDATE, DELETE, TRUNCATE) on tables
    EXECUTE IMMEDIATE ''
        GRANT SELECT, INSERT, UPDATE, DELETE, TRUNCATE 
        ON ALL TABLES IN SCHEMA PRD_DATAACCESSPOC_DB.DATAMASKING 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_READ'';

    
    RETURN ''All grants executed successfully'';
END;
';
CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_PRD_DATAACCESSPOC_DB_WRITE"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN
    -- Grant basic access to the database
    EXECUTE IMMEDIATE ''GRANT USAGE ON DATABASE PRD_DATAACCESSPOC_DB 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_WRITE'';

    -- Grant access to schemas (existing only)
    EXECUTE IMMEDIATE ''GRANT USAGE ON SCHEMA PRD_DATAACCESSPOC_DB.DATAMASKING 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_WRITE'';

    -- Grant object creation permissions in schemas (existing only)
    EXECUTE IMMEDIATE ''
        GRANT CREATE TABLE, CREATE VIEW, CREATE MATERIALIZED VIEW, CREATE DYNAMIC TABLE, 
              CREATE STAGE, CREATE FILE FORMAT, 
              CREATE PROCEDURE, CREATE FUNCTION, CREATE PIPE 
        ON SCHEMA PRD_DATAACCESSPOC_DB.DATAMASKING 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_WRITE'';

    -- Grant modification permissions (DML: INSERT, UPDATE, DELETE, TRUNCATE) on tables
    EXECUTE IMMEDIATE ''
        GRANT SELECT, INSERT, UPDATE, DELETE, TRUNCATE 
        ON ALL TABLES IN SCHEMA PRD_DATAACCESSPOC_DB.DATAMASKING 
        TO DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_WRITE'';

    
    RETURN ''All grants executed successfully'';
END;
';
CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_PROD_MASKPOC_ANALYST"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN
    --Grant WAREHOUSE 
    EXECUTE IMMEDIATE ''GRANT USAGE ON WAREHOUSE DEV_BI_WH_XS TO ROLE PROD_MASKPOC_ANALYST'';

    --GRANT DB ROLES
    EXECUTE IMMEDIATE ''GRANT DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_READ TO ROLE PROD_MASKPOC_ANALYST'';
    
    RETURN ''All grants executed successfully'';
END;
';
CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_PROD_MASKPOC_BA"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN

    --Grant WAREHOUSE 
    EXECUTE IMMEDIATE ''GRANT USAGE ON WAREHOUSE DEV_BI_WH_XS TO ROLE PROD_MASKPOC_BA'';

    --GRANT DB ROLES
    EXECUTE IMMEDIATE ''GRANT DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_READ TO ROLE PROD_MASKPOC_BA'';
    
    RETURN ''All grants executed successfully'';
END;
';
CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_PROD_MASKPOC_DEVELOPER"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN  
    --Grant WAREHOUSE 
    EXECUTE IMMEDIATE ''GRANT USAGE ON WAREHOUSE DEV_BI_WH_XS TO ROLE PROD_MASKPOC_DEVELOPER'';

    --GRANT DB ROLES
    EXECUTE IMMEDIATE ''GRANT DATABASE ROLE PRD_DATAACCESSPOC_DB.PRD_DATAACCESSPOC_DB_READ TO ROLE PROD_MASKPOC_DEVELOPER'';

    
    RETURN ''All grants executed successfully'';
END;
';
CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_TAGADMIN"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN
    -- Grant basic access to the database
    EXECUTE IMMEDIATE ''GRANT CREATE TAG ON SCHEMA ADMIN_DB.TAGS TO ROLE TAG_ADMIN'';

    -- Grant access to schemas (existing only)
    EXECUTE IMMEDIATE ''GRANT APPLY TAG ON ACCOUNT TO ROLE TAG_ADMIN'';
    
    RETURN ''All grants executed successfully'';
END;
';
CREATE OR REPLACE PROCEDURE "PROC_GRANT_ACCESS_TAGUSER"()
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS '
BEGIN
    -- Grant basic access to the database
    EXECUTE IMMEDIATE ''GRANT APPLY TAG ON ACCOUNT TO ROLE TAG_USER'';
    
    RETURN ''All grants executed successfully'';
END;
';
create or replace schema TAGS;

create or replace tag MASKDATA_ROLE_TAG  allowed_values  'PARTIAL' , 'FULL' , 'NONE' ;
create or replace tag MASKING_TAG  allowed_values  'NORMAL' , 'EMAIL' ;